## Synopsis

This repository contains the code for the final project of 16-782: Planning and Decision-making in Robotics taught by Dr. Maxim Likhachev at Carnegie Mellon University.

## Motivation

At a high-level the concept is straightforward: the optimal path between two points inside a convex shape is a straight line between start and goal.  We take advantage of this fact by using the Optimal Mass Transport algorithm to transform any non-convex 2D world into a convex 2D world, plan in the 2D world via a straight line and then transform the resulting plan back to the original non-transformed world map's coordinates.

The following documents may assist in understanding the specifics of the process better:
- [Paper](https://docs.google.com/document/d/1epEVQY2vjS015mPKW3WIU1knv3y7Y7r4BKxOtym3-Ac/edit?usp=sharing)
- [Final Presentation Deck](https://docs.google.com/presentation/d/1A9DAG0TuxJSP5PY58Fdn271-WyBUL8VWUlg9NfhsWcA/edit?usp=sharing)
- [Proposal Presentation Deck](https://docs.google.com/presentation/d/1fOOvvIS2I26OiJEcf8RLyGspf5T9ztZB_mw6rn48-vI/edit?usp=sharing)

## Installation

Windows is required to run the programs that perform the transformation.

For the planning step, Matlab is required.  If you go to CMU, installation instructions for the student version of Matlab may be found [here](https://www.cmu.edu/computing/software/all/matlab/).  This step may be done on the provided example world map.

## Code Example

The process to perform convex planning consists of 3 steps.

1. Generate the world map.
- Add the "./Matlab" folder/subfolders to the path.
- Open "generateOff.m" and modify the last line to a file name of your choice
`writeToOff('shape4.off', xPos, yPos, triangles, 1, 1);`
- Run "generateOff.m" and draw the world by clicking points.
- Upon closing the contour (by clicking the initial point), the world will be discretized to a grid of triangles and an OFF file containing the discretized map will be saved to the afformentioned file.

2. Tranform the world map.
- Original instructions on how to run the transformation code may be found on Dr. David Gu's website [here](http://www3.cs.stonybrook.edu/~gu/software/omt/index.html).
- First download the omt-binary code from David Gu's website [here](http://www3.cs.stonybrook.edu/~gu/software/omt/omt-binary.rar).  Unzip the rar file (I will assume you unzipped it to the top-level directory).  See the installation instructions in the previous section for a guide to building the omt-binary code.
- Move the generated OFF file from the previous step to the "./omt-binary/bin" directory. 
- Via the Windows command line, cd to the "./omt-binary/bin" directory
- Run the following command:
`omt2d.exe -input inputFileName.off -output outputFileName.off -threshold 0.02`
- Modify "inputFileName.off" to correspond to the name the OFF file generated from step 1 had and change "outputFileName.off" to a name of your choice.
- You may have to use the Windows task manager to end the "Mesh Viewer" task for the transformation step to complete.
- If the transformation does not converge after 1,000 iterations, stop the command and set the "threshold" option in the command above to a value slightly greater than the error in the last step.

3. Run the planner.
- Move the original OFF file (generated from step 1) and the transformed OFF file (generated from step 2) to the "./Matlab" directory
- Open 'runPlanner.m' (in the Matlab directory) and modify the following lines
`[X, Y, TRI] = readOff('shape.off');`
`[X_trans, Y_trans, ~] = readOff('shape_omt.off');`
such that 'shape.off' corresponds to the OFF file generated by step 1 and 'shape_omt.off' corresponds to the shape file generated by step 2.
- Run 'runPlanner.m'
- Choose a start point and an end point
- The resulting plan should be generated and displayed.  The red path is the generated plan and the blue path is the optimal path.  The path lengths should be printed on the Matlab console.

## Contributors

Nima Rahnemoon [nrahnemoon](https://github.com/nrahnemoon)
Cyrus Xiyuan Liu [cyrusxyl](https://github.com/cyrusxyl)
Siddarth Raina [sraina1](https://github.com/sraina1)
Shreshta Shetty [shreshta9](https://github.com/shreshta9)

## Contact

Feel free to contact Nima (nrahnemoon at gmail.com) if you have any questions.

## License

The MIT License

Copyright (c) 2017

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
